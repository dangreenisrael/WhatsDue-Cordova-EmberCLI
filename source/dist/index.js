var pushNotification=window.plugins.pushNotification,cordovaLoaded=!1;console.log("Cordova Loaded: "+cordovaLoaded);var cordovaApp={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){cordovaApp.receivedEvent("deviceready"),console.log("Device Ready"),cordovaLoaded=!0},receivedEvent:function(e){"android"==device.platform||"Android"==device.platform?pushNotification.register(cordovaApp.successHandler,cordovaApp.errorHandler,{senderID:"577888563057",ecb:"cordovaApp.onNotificationGCM"}):pushNotification.register(cordovaApp.tokenHandler,cordovaApp.errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"})},tokenHandler:function(e){console.log("device token = "+e),console.log("device UUID = "+device.uuid),console.log("device name = "+device.platform);var o={uuid:device.uuid,platform:device.platform,pushId:e,school:getSchool()};$.ajax({url:site+"/students",type:"POST",data:o,success:function(e){console.log(e),localStorage.setItem("primaryKey",e.primaryKey)},error:function(e){console.log(e)}})},successHandler:function(e){console.log("Success Handler = "+e)},errorHandler:function(e){alert("Error Handler = "+e)},onNotificationGCM:function(e){function o(){window.location.hash="/"}switch(e.event){case"registered":var n={uuid:device.uuid,platform:device.platform,pushId:e.regid};$.ajax({url:site+"/students",type:"POST",data:n,success:function(e){localStorage.setItem("primaryKey",e.primaryKey)}});break;case"message":console.log(e);var a=e.payload;if(a.assignmentId){var i=new CustomEvent("updatedAssignment");window.dispatchEvent(i),navigator.notification.alert(a.message,o,a.title,"OK")}break;case"error":console.log("GCM error = "+e.msg);break;default:console.log("An unknown GCM event has occurred")}},onNotificationAPN:function(e){if(e.alert&&navigator.notification.alert(e.alert),e.sound){var o=new Media(e.sound);o.play()}e.badge&&pushNotification.setApplicationIconBadgeNumber(successHandler,errorHandler,e.badge)}};cordovaApp.initialize();